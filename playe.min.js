var playe=function(){var e={},t=document.querySelectorAll("script[type='text/playe']");e.new=function(e){};var a=null;function n(e){1==this.settings.random&&(e="random");var t=function(e,t){switch(t){case"next":return 1==e.settings.loop?e.playingTrack<e.tracks.length-1?e.playingTrack+1:0:e.playingTrack<e.tracks.length-1?e.playingTrack+1:null;case"previous":return 1==e.settings.loop?e.playingTrack>0?e.playingTrack-1:e.tracks.length-1:e.playingTrack>0?e.playingTrack-1:null}}(this,e);this.lT(t),1==this.isPlaying&&this.play()}function i(e){e.audio=document.createElement("audio"),e.audio.className="playe-audio",e.appendChild(e.audio)}function r(e){var t={};return t.controls=void 0!=e.getAttribute("playe-controls"),t.loop=void 0!=e.getAttribute("playe-loop"),t}function s(e,t,a){var n=document.createElement("div");n.className="playe-button";var i,r="";return'"'==t[0]?((i=document.createElement("img")).src=t.substr(1,t.length-2),r="max-height:100%;"):(i=document.createElement("span")).innerHTML=t,i.style=r+"display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",n.appendChild(i),a&&n.addEventListener("click",a),n}function l(e,t){var a=document.createElement("div");a.className="playe-text";var n=document.createElement("span");return n.innerHTML=t,n.style="display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",a.appendChild(n),a}function o(e){var t=String(Math.floor(e/60)%60),a=String(Math.floor(e/3600)),n=String(e%60);return(a>"0"?a+":":"")+(1==t.length?"0"+t:t)+":"+(1==n.length?"0"+n:n)}e.convert=function(){for(var s=0;s<t.length;s++){var l=t[s],o=l.innerHTML,u=(r(l),document.createElement("div"));a=u;var c="display:inline-flex; flex-wrap:wrap;";void 0!=l.getAttribute("playe-width")&&(c+="width:"+l.getAttribute("playe-width")+";"),void 0!=l.getAttribute("playe-height")&&(c+="height:"+l.getAttribute("playe-height")+";"),u.style=c,u.className="playe"+(""!=l.className?" "+l.className:"");var d=e.playeParse(o);i(u),u.bloc=document.createElement("div"),u.bloc.style="position:fixed;top:0;left:0;bottom:0;right:0;z-index:100;",u.tracks=d.tracks,u.audio.src=u.tracks[0].src[0].value,u.duration=0,u.audio.oncanplaythrough=function(){u.duration=u.audio.duration},u.playingTrack=0,u.settings=d.settings,u.settings.preload&&(u.audio.preload=!0),u.isPlaying=u.settings.autoplay,u.randomList=[],u.play=function(){u.audio.play(),u.isPlaying=!0,u.className="playe playing"},u.pause=function(){u.audio.pause(),u.isPlaying=!1,u.className="playe stopped"},u.next=n.bind(u,"next"),u.previous=n.bind(u,"previous"),u.test=function(e){return""!=u.audio.canPlayType(e)},u.loadTrack=loadTrack,u.audio.onended=n.bind(u,"next"),u.audio.onloadstart=function(){u.dataset.loading="true"},u.audio.oncanplaythrough=function(){u.dataset.loading="false"},u.isPlaying&&u.play(),e.populate(u,d.layout),u.setTitle=function(e){this.parts.title&&this.parts.title.setValue(e)},u.setTitle(u.tracks[0].title),l.parentNode.insertBefore(u,l),l.parentNode.removeChild(l)}};var u=function(){var e="playe-slider",t=function(e){var t=document.createElement("div");return t.className=e,t};function n(){var a=t(e+"-back");return a.style="position:relative;top:50%;transform:translate(0,-50%);width:100%;",a}function i(){var a=t(e+"-played");return a.style="position:absolute; pointer-events:none; top:0; left:0; bottom:0; right:0;",a.setLenght=function(e){this.style.right=e+"px"},a.style.right="100%",a}function r(e){var t=Math.round(a.audio.duration*e,2)+"",n=String(Math.floor(t/60)%60),i=String(Math.floor(t/3600)),r=String(t%60);return(i>"0"?i+":":"")+(1==n.length?"0"+n:n)+":"+(1==r.length?"0"+r:r)}function s(){return this.back.offsetWidth-(this.curs?this.curs.offsetWidth:5)}function l(e){return e.getBoundingClientRect().left}function o(e){return(e.clientX-u.call(this)-l(this.back))/this.bW()}function u(){return this.curs?this.curs.offsetWidth/2:0}function c(e){this.dragging=!0,window.addEventListener("mouseup",this.mU,!1),window.addEventListener("mousemove",this.moveCursor,!1),this.moveCursor(e),this.curs&&(this.curs.dataset.playeActive=!0),a.appendChild(a.bloc)}return{Tml:function(d,p){var h,m,v=document.createElement("div");return v.className="playe-timeline",v.back=n(),v.loaded=((h=t(e+"-loaded")).style="position:absolute; pointer-events:none; top:0; left:0; bottom:0; right:0;",h.setLenght=function(e){this.style.right=e+"px"},h.style.right="100%",h),v.played=i(),v.curs=((m=t(e+"-cursor")).style="position:absolute; cursor: pointer;",m.dataset.playeSliderValue="00:00",m),v.back.appendChild(v.loaded),v.back.appendChild(v.played),v.back.appendChild(v.curs),v.appendChild(v.back),v.dragging=!1,v.value=0,v.valueChange=function(){d.audio.currentTime=d.audio.duration*this.value},v.bW=s,v.cP=o,v.mD=c.bind(v),v.mU=function(e){1==this.dragging&&(this.moveCursor(e),window.removeEventListener("mousemove",this.moveCursor,!1),window.removeEventListener("mouseup",this.mU,!1),this.value=this.cP(e),this.valueChange()),this.dragging=!1,this.curs.dataset.playeActive=!1,a.bloc.parentNode.removeChild(a.bloc)}.bind(v),v.moveCursor=function(e){var t=e.clientX-u.call(this)-l(this.back),a=Math.max(0,Math.min(t,this.bW()));this.played.setLenght(this.bW()-a),this.curs.style.marginLeft=a+"px";var n=Math.max(0,Math.min(this.cP(e),1));this.curs.dataset.playeSliderValue=r(n)}.bind(v),v.back.addEventListener("mousedown",v.mD,!1),setInterval(function(){if(!this.dragging&&d.isPlaying){var e=d.audio.currentTime/d.audio.duration,t=this.bW()*e;this.curs.style.marginLeft=1+t+"px",this.played.setLenght(this.bW()-t)}}.bind(v),40),d.audio.onprogress=function(e){var t;try{t=this.buffered.end(this.buffered.length-1)/this.duration*v.bW()}catch(e){}v.loaded.setLenght(v.bW()-t)},d.audio.addEventListener("durationchange",function(){var e=r(1);v.dataset.playeDuration=e}),v},Vl:function(e,t){var r=document.createElement("div");return r.className="playe-volume",r.back=n(),r.played=i(),r.back.appendChild(r.played),r.appendChild(r.back),r.dragging=!1,r.value=t,r.played.setLenght(1-t),r.valueChange=function(){e.audio.volume=this.value},r.valueChange(),r.bW=s,r.cP=o,r.mD=c.bind(r),r.mU=function(e){1==this.dragging&&(this.moveCursor(e),window.removeEventListener("mousemove",this.moveCursor,!1),window.removeEventListener("mouseup",this.mU,!1)),this.dragging=!1,a.bloc.parentNode.removeChild(a.bloc)}.bind(r),r.moveCursor=function(e){var t=e.clientX-u.call(this)-l(this.back),a=Math.max(0,Math.min(t,this.bW()));this.played.setLenght(this.bW()-a);var n=Math.max(0,Math.min(this.cP(e),1));this.value=n,this.valueChange()}.bind(r),r.back.addEventListener("mousedown",r.mD,!1),r},fTime:r}}(),c={play:"►",pause:"▍▍",next:"→",previous:"←",slider:"",volume:"1",title:"",playlist:"4",time:!1};function d(e){var t,a=0;(t=/([+-]+)?\s*(.+)/.exec(e))&&(e=t[2],t[1]&&(a="-"==t[1][0]?-1*t[1].length:t[1].length));var n={element:e,value:c[e],weight:a};return(t=/\s*(.+?)\s*(::)\s*(.*)/.exec(e))&&(n.element=t[2],n.value=t[4]),n}function p(e,t){switch(e){case"mp3":return"audio/mpeg";case"ogg":return"audio/ogg";case"wav":return"audio/wav";default:return t}}function h(e,t){switch(t.element){case"play":return k=e,x=t.value,(E=s(0,x,k.play)).className+=" playe-play",E;case"pause":return y=e,f=t.value,(b=s(0,f,y.pause)).className+=" playe-pause",b;case"next":return m=e,v=t.value,(g=s(0,v,m.next)).className+=" playe-next",g;case"previous":return d=e,p=t.value,(h=s(0,p,d.previous)).className+=" playe-previous",h;case"button":return s(0,t.value);case"img":return i=t.value,(c=document.createElement("div")).className="playe-image",(r=document.createElement("img")).src=i.substr(1,i.length-2),r.style="max-height:100%;display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",c.appendChild(r),c;case"html":return a=t.value.substr(1,t.value.length-2),(n=document.createElement("div")).innerHTML=a,n;case"text":return l(0,t.value);case"volume":return u.Vl(e,t.value);case"timeline":return u.Tml(e,t.value);case"time":return function(e,t){var a=document.createElement("div");a.className="playe-time";var n=document.createElement("span");return n.style="display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",e.audio.addEventListener("durationchange",function(){var e=o(Math.round(this.duration,2));t&&(e=o(Math.round(this.currentTime,2))+t+e),n.innerHTML=e}),e.audio.addEventListener("timeupdate",function(){if(!isNaN(this.duration)){var e=o(Math.round(this.duration,2));t&&(e=o(Math.round(this.currentTime,2))+t+e),n.innerHTML=e}}),a.appendChild(n),a}(e,t.value);case"title":return function(e,t){var a=document.createElement("div");a.className="playe-title";var n=document.createElement("h3");return n.innerHTML=t,n.style="display:inline-block;margin:0 auto;position:relative;top:50%;transform:translate(0,-50%);",a.appendChild(n),a.setValue=function(e){n.innerHTML=e},a}(0,t.value);case"playlist":return function(e,t){var a=e.tracks,n=document.createElement("div");n.className="playe-list";for(var i=document.createElement("ol"),r=0;r<a.length;r++){var s=document.createElement("li");s.className="playe-list-item",s.innerHTML=a[r].title,s.onclick=e.loadTrack.bind(e,a[r].id-1),i.appendChild(s)}return i.style="display:block;overflow-y:auto;list-style-position:inside;padding-left:0;",n.appendChild(i),n}(e,t.value);default:return l(0,t.value)}var a,n,i,r,c,d,p,h,m,v,g,y,f,b,k,x,E}return e.playeParse=function(e){for(var t={settings:{},layout:[],tracks:[]},a=(e=(e=e.replace(/\n\s*(:\w{0,3}:)/g," $1")).replace(/\s\/\/(.*)\n/g,"\n")).split(/\r\n|\r|\n/),n=0;n<a.length;n++){var i,r,s=a[n].trim();if(i=/(\d)\.\s?(.*?)\s*:(\w{3})?:\s*"([^"]+?)"(.*)/.exec(s)){var l={id:i[1]};l.title=i[2]?i[2]:"Track "+i[1],l.src=[{type:p(i[3],t.settings.type),value:i[4]}],(c=function(e){(r=/\s*:(\w{3})?:\s*"([^"]+)"(.*)/.exec(e))&&(l.src.push({type:p(r[1],t.settings.type),value:r[2]}),r[3]&&c(r[3]))})(i[5]),t.tracks.push(l)}else if(i=/\((.+)\)/.exec(s)){var o={loop:!1,random:!1,autoplay:!1,type:"audio/ogg"};(c=function(e){(r=/.*?([^, ]+)(.*)/.exec(e))&&(":"==r[1][0]?o.type=p(r[1].replace(/:/g,""),"audio/ogg"):o[r[1]]=!0,r[2]&&c(r[2]))})(i[1]),t.settings=o}else if(i=/\[([^\]]+)\](.*)/.exec(s)){var u=[];u.push(d(i[1]));var c=function(e){(r=/\s*\[([^\]]+)\](.*)/.exec(e))&&(u.push(d(r[1])),r[2]&&c(r[2]))};i[2]&&c(i[2]),t.layout.push(u)}}return t},e.populate=function(e,t){for(var a={},n=(document.createElement("div"),0);n<t.length;n++)for(var i=t[n],r=i.length,s=100/r,l=0;l<r;l++)a[i[l].element]=h(e,i[l]),a[i[l].element].style="flex: 1 1 "+(s+10*i[l].weight-5)+"%",e.appendChild(a[i[l].element]);e.parts=a},e}();