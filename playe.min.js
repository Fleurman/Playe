var playe=function(){function e(e){if(null!=e){var n=t(this,this.tracks[e].src);if(null==n)return this.playingTrack=e,this.next();this.audio.src=n,this.setTitle(this.tracks[e].title),this.playingTrack=e}}function t(e,t){for(var n=0;n<t.length;n++)if(e.test(t[n].type))return t[n].value;return null}function n(e){1==this.settings.random&&(e="random");var t=a(this,e);this.loadTrack(t),1==this.isPlaying&&this.play()}function a(e,t){switch(t){case"next":return 1==e.settings.loop?e.playingTrack<e.tracks.length-1?e.playingTrack+1:0:e.playingTrack<e.tracks.length-1?e.playingTrack+1:null;case"previous":return 1==e.settings.loop?e.playingTrack>0?e.playingTrack-1:e.tracks.length-1:e.playingTrack>0?e.playingTrack-1:null}}function i(e){e.audio=document.createElement("audio"),e.audio.className="playe-audio",e.appendChild(e.audio)}function r(e,t,n){var a=document.createElement("div");a.className="playe-button";var i,r="";return'"'==t[0]?(i=document.createElement("img"),i.src=t.substr(1,t.length-2),r="max-height:100%;"):(i=document.createElement("span"),i.innerHTML=t),i.style=r+"display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",a.appendChild(i),n&&a.addEventListener("click",n),a}function s(e,t){var n=r(e,t,e.play);return n.className+=" playe-play",n}function l(e,t){var n=r(e,t,e.pause);return n.className+=" playe-pause",n}function o(e,t){var n=r(e,t,e.next);return n.className+=" playe-next",n}function u(e,t){var n=r(e,t,e.previous);return n.className+=" playe-previous",n}function c(e,t){var n=document.createElement("div");n.className="playe-image";var a,i="";return a=document.createElement("img"),a.src=t.substr(1,t.length-2),a.style=i+"max-height:100%;display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",n.appendChild(a),n}function d(e,t){var n=document.createElement("div");n.className="playe-text";var a=document.createElement("span");return a.innerHTML=t,a.style="display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",n.appendChild(a),n}function p(e,t){var n=document.createElement("div");return n.innerHTML=t,n}function h(e,t){var n=e.tracks,a=document.createElement("div");a.className="playe-list";for(var i=document.createElement("ol"),r=0;r<n.length;r++){var s=document.createElement("li");s.className="playe-list-item",s.innerHTML=n[r].title,s.onclick=e.loadTrack.bind(e,n[r].id-1),i.appendChild(s)}return i.style="display:block;overflow-y:auto;list-style-position:inside;padding-left:0;",a.appendChild(i),a}function v(e,t){var n=document.createElement("div");n.className="playe-title";var a=document.createElement("h3");return a.innerHTML=t,a.style="display:inline-block;margin:0 auto;position:relative;top:50%;transform:translate(0,-50%);",n.appendChild(a),n.setValue=function(e){a.innerHTML=e},n}function m(e,t){var n=document.createElement("div");n.className="playe-time";var a=document.createElement("span");return a.style="display:inline-block;position:relative;top:50%;transform:translate(0,-50%);",e.audio.addEventListener("durationchange",function(){var e=g(Math.round(this.duration,2));t&&(e=g(Math.round(this.currentTime,2))+t+e),a.innerHTML=e}),e.audio.addEventListener("timeupdate",function(){if(!isNaN(this.duration)){var e=g(Math.round(this.duration,2));t&&(e=g(Math.round(this.currentTime,2))+t+e),a.innerHTML=e}}),n.appendChild(a),n}function g(e){var t=String(Math.floor(e/60)%60),n=String(Math.floor(e/3600)),a=String(e%60);return(n>"0"?n+":":"")+(1==t.length?"0"+t:t)+":"+(1==a.length?"0"+a:a)}function y(e){var t,n={element:e,value:C[e]};let a=e.split("::"),i=a[0];return a[1]&&(n.value=a[1]),(t=/(?:([+-]+)\s*)?(.+)/.exec(i))&&(n.element=t[2],t[1]&&(n.value=C[t[2]],n.weight="-"==t[1][0]?-1*t[1].length:t[1].length)),n}function f(e,t){switch(e){case"mp3":return"audio/mpeg";case"ogg":return"audio/ogg";case"wav":return"audio/wav";default:return t}}function b(e,t){switch(t.element){case"play":return s(e,t.value);case"pause":return l(e,t.value);case"next":return o(e,t.value);case"previous":return u(e,t.value);case"button":return r(e,t.value);case"img":return c(e,t.value);case"html":return p(e,t.value.substr(1,t.value.length-2));case"text":return d(e,t.value);case"volume":return x.Volume(e,t.value);case"timeline":return x.Timeline(e,t.value);case"time":return m(e,t.value);case"title":return v(e,t.value);case"playlist":return h(e,t.value);default:return d(e,t.value)}}var k={},w=document.querySelectorAll("script[type='text/playe']");k.new=function(t){var a=document.createElement("div");T=a,a.style="display:inline-flex; flex-wrap:wrap;",a.className="playe";var r=k.playeParse(t);return i(a),a.bloc=document.createElement("div"),a.bloc.style="position:fixed;top:0;left:0;bottom:0;right:0;z-index:100;",a.tracks=r.tracks,a.audio.src=a.tracks[0].src[0].value,a.duration=0,a.audio.oncanplaythrough=function(){a.duration=a.audio.duration},a.playingTrack=0,a.settings=r.settings,a.settings.preload&&(a.audio.preload=!0),a.isPlaying=a.settings.autoplay,a.randomList=[],a.play=function(){a.audio.play(),a.isPlaying=!0,a.className="playe playing"},a.pause=function(){a.audio.pause(),a.isPlaying=!1,a.className="playe stopped"},a.next=n.bind(a,"next"),a.previous=n.bind(a,"previous"),a.test=function(e){return""!=a.audio.canPlayType(e)},a.loadTrack=e,a.audio.onended=n.bind(a,"next"),a.audio.onloadstart=function(){a.dataset.loading="true"},a.audio.oncanplaythrough=function(){a.dataset.loading="false"},a.isPlaying&&a.play(),k.populate(a,r.layout),a.setTitle=function(e){this.parts.title&&this.parts.title.setValue(e)},a.setTitle(a.tracks[0].title),a};var T=null;k.convert=function(){for(var e=0;e<w.length;e++){var t=w[e],n=t.innerHTML;let a=k.new(n);a.className+=""!=t.className?" "+t.className:"",null!=t.getAttribute("playe-width")&&(a.style+="width:"+t.getAttribute("playe-width")+";"),null!=t.getAttribute("playe-height")&&(a.style+="height:"+t.getAttribute("playe-height")+";"),t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t)}};var x=function(){function e(){var e=y(g+"-back");return e.style="position:relative;top:50%;transform:translate(0,-50%);width:100%;",e}function t(){var e=y(g+"-loaded");return e.style="position:absolute; pointer-events:none; top:0; left:0; bottom:0; right:0;",e.setLenght=function(e){this.style.right=e+"px"},e.style.right="100%",e}function n(){var e=y(g+"-played");return e.style="position:absolute; pointer-events:none; top:0; left:0; bottom:0; right:0;",e.setLenght=function(e){this.style.right=e+"px"},e.style.right="100%",e}function a(){var e=y(g+"-cursor");return e.style="position:absolute; cursor: pointer;",e.dataset.playeSliderValue="00:00",e}function i(e){var t=Math.round(T.audio.duration*e,2)+"",n=String(Math.floor(t/60)%60),a=String(Math.floor(t/3600)),i=String(t%60);return(a>"0"?a+":":"")+(1==n.length?"0"+n:n)+":"+(1==i.length?"0"+i:i)}function r(){return this.back.offsetWidth-(this.curs?this.curs.offsetWidth:5)}function s(e){return e.getBoundingClientRect().left}function l(e){return(e.clientX-o.call(this)-s(this.back))/this.backWidth()}function o(){return this.curs?this.curs.offsetWidth/2:0}function u(e){this.dragging=!0,window.addEventListener("mouseup",this.mouseUp,!1),window.addEventListener("mousemove",this.moveCursor,!1),this.moveCursor(e),this.curs&&(this.curs.dataset.playeActive=!0),T.appendChild(T.bloc)}function c(e){1==this.dragging&&(this.moveCursor(e),window.removeEventListener("mousemove",this.moveCursor,!1),window.removeEventListener("mouseup",this.mouseUp,!1)),this.dragging=!1,T.bloc.parentNode.removeChild(T.bloc)}function d(e){1==this.dragging&&(this.moveCursor(e),window.removeEventListener("mousemove",this.moveCursor,!1),window.removeEventListener("mouseup",this.mouseUp,!1),this.value=this.clickPercent(e),this.valueChange()),this.dragging=!1,this.curs.dataset.playeActive=!1,T.bloc.parentNode.removeChild(T.bloc)}function p(e){var t=e.clientX-o.call(this)-s(this.back),n=Math.max(0,Math.min(t,this.backWidth()));this.played.setLenght(this.backWidth()-n),this.curs.style.marginLeft=n+"px";var a=Math.max(0,Math.min(this.clickPercent(e),1));this.curs.dataset.playeSliderValue=i(a)}function h(e){var t=e.clientX-o.call(this)-s(this.back),n=Math.max(0,Math.min(t,this.backWidth()));this.played.setLenght(this.backWidth()-n);var a=Math.max(0,Math.min(this.clickPercent(e),1));this.value=a,this.valueChange()}function v(s,o){function c(){if(!this.dragging&&s.isPlaying){var e=s.audio.currentTime/s.audio.duration,t=this.backWidth()*e;this.curs.style.marginLeft=1+t+"px",this.played.setLenght(this.backWidth()-t)}}var h=document.createElement("div");return h.className="playe-timeline",h.back=e(),h.loaded=t(),h.played=n(),h.curs=a(),h.back.appendChild(h.loaded),h.back.appendChild(h.played),h.back.appendChild(h.curs),h.appendChild(h.back),h.dragging=!1,h.value=0,h.valueChange=function(){s.audio.currentTime=s.audio.duration*this.value},h.backWidth=r,h.clickPercent=l,h.mouseDown=u.bind(h),h.mouseUp=d.bind(h),h.moveCursor=p.bind(h),h.back.addEventListener("mousedown",h.mouseDown,!1),setInterval(c.bind(h),40),s.audio.onprogress=function(e){var t;try{t=this.buffered.end(this.buffered.length-1)/this.duration*h.backWidth()}catch(e){}h.loaded.setLenght(h.backWidth()-t)},s.audio.addEventListener("durationchange",function(){var e=i(1);h.dataset.playeDuration=e}),h}function m(t,a){var i=document.createElement("div");return i.className="playe-volume",i.back=e(),i.played=n(),i.back.appendChild(i.played),i.appendChild(i.back),i.dragging=!1,i.value=a,i.played.setLenght(1-a),i.valueChange=function(){console.log(this.value),t.audio.volume=parseFloat(this.value)},i.valueChange(),i.backWidth=r,i.clickPercent=l,i.mouseDown=u.bind(i),i.mouseUp=c.bind(i),i.moveCursor=h.bind(i),i.back.addEventListener("mousedown",i.mouseDown,!1),i}var g="playe-slider",y=function(e){var t=document.createElement("div");return t.className=e,t};return{Timeline:v,Volume:m,fTime:i}}(),C={play:"►",pause:"❙❙",next:"→",previous:"←",slider:"",volume:"1",title:"",playlist:"4",time:!1};return k.playeParse=function(e){e=e.replace(/\n\s*(:\w{0,3}:)/g," $1"),e=e.replace(/\s\/\/(.*)\n/g,"\n");for(var t={settings:{},layout:[],tracks:[]},n=e.split(/\r\n|\r|\n/),a=0;a<n.length;a++){var i,r,s=n[a].trim();if(i=/(\d)\.\s?(.*?)\s*:(\w{3})?:\s*"([^"]+?)"(.*)/.exec(s)){var l={id:i[1]};l.title=i[2]?i[2]:"Track "+i[1],l.src=[{type:f(i[3],t.settings.type),value:i[4]}];var o=function(e){(r=/\s*:(\w{3})?:\s*"([^"]+)"(.*)/.exec(e))&&(l.src.push({type:f(r[1],t.settings.type),value:r[2]}),r[3]&&o(r[3]))};o(i[5]),t.tracks.push(l)}else if(i=/\((.+)\)/.exec(s)){var u={loop:!1,random:!1,autoplay:!1,type:"audio/ogg"};o=function(e){(r=/.*?([^, ]+)(.*)/.exec(e))&&(":"==r[1][0]?u.type=f(r[1].replace(/:/g,""),"audio/ogg"):u[r[1]]=!0,r[2]&&o(r[2]))};o(i[1]),t.settings=u}else if(i=/\[([^\]]+)\](.*)/.exec(s)){var c=[];c.push(y(i[1]));o=function(e){(r=/\s*\[([^\]]+)\](.*)/.exec(e))&&(c.push(y(r[1])),r[2]&&o(r[2]))};i[2]&&o(i[2]),t.layout.push(c)}}return t},k.populate=function(e,t){for(var n={},a=0;a<t.length;a++)for(var i=t[a],r=i.length,s=100/r,l=0;l<r;l++)n[i[l].element]=b(e,i[l]),n[i[l].element].style="flex: 1 1 "+(s+10*i[l].weight-5)+"%",e.appendChild(n[i[l].element]);e.parts=n},k}();playe.convert();